import { CodeGroup } from '../code.tsx'
import { Row, Col, Properties, Property, Heading, SubProperty } from '../md.tsx'

# 对话型应用 API

可用于大部分场景的对话型应用，采用一问一答模式与用户持续对话。要开始一个对话请调用 send-messages 接口，通过继续传入返回的 conversation_id 可持续保持该会话。

<Heading
  url='/send-messages'
  method='POST'
  title='发送对话消息'
  name='#Create-Chat-Message'
/>
<Row>
  <Col>
    创建会话消息，或基于此前的对话继续发送消息。

    ### Request Body

    <Properties>
      <Property name='inputs' type='object' key='inputs'>
        （选填）以键值对方式提供用户输入字段，与提示词编排中的变量对应。Key 为变量名称，Value 是参数值。如果字段类型为 Select，传入的 Value 需为预设选项之一。
        <ul>
         {!!props.variables.length && props.variables.map(
            val => (
                <SubProperty name={val.key} type={val.type} key={val.key}>
                  {val.name ? `${val.name}` : ''}
                </SubProperty>
            )
        )}
        </ul>
      </Property>
      <Property name='query' type='string' key='query'>
        用户输入/提问内容
      </Property>
      <Property name='response_mode' type='string' key='response_mode'>
        - blocking 阻塞型，等待执行完毕后返回结果。（请求若流程较长可能会被中断）
        - streaming 流式返回。基于 SSE（**[Server-Sent Events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events)**）实现流式返回。
      </Property>
      <Property name='conversation_id' type='string' key='conversation_id'>
      （选填）会话标识符，首次对话可为空，如果要继续对话请传入上下文返回的 conversation_id
      </Property>
      <Property name='user' type='string' key='user'>
        用户标识，由开发者定义规则，需保证用户标识在应用内唯一。
      </Property>
    </Properties>
  </Col>
</Row>

---

<Heading
  url='/chats/{message_id}/feedbacks'
  method='POST'
  title='消息反馈（点赞）'
  name='#feedbacks'
/>
<Row>
  <Col>
    代表最终用户对返回消息进行评价，可以点赞与点踩，该数据将在“日志与标注”页中可见，并用于后续的模型微调。

    ### Path Params
    <Properties>
      <Property name='message_id' type='string' key='message_id'>
       消息 ID
      </Property>
    </Properties>

    ### Request Body

    <Properties>
      <Property name='rating' type='string' key='rating'>
       like 或 dislike， 空值为撤销
      </Property>
      <Property name='user' type='string' key='user'>
        用户标识，由开发者定义规则，需保证用户标识在应用内唯一。
      </Property>
    </Properties>
  </Col>
</Row>

---

<Heading
  url='/chats'
  method='GET'
  title='获取会话历史消息'
  name='#messages'
/>
<Row>
  <Col>
    滚动加载形式返回历史聊天记录，第一页返回最新 `limit` 条，即：倒序返回。

    ### Query

    <Properties>
      <Property name='conversation_id' type='string' key='conversation_id'>
        会话 ID
      </Property>
      <Property name='first_id' type='string' key='first_id'>
        当前页第一条聊天记录的 ID，默认 none
      </Property>
      <Property name='limit' type='int' key='limit'>
        一次请求返回多少条聊天记录
      </Property>
      <Property name='user' type='string' key='user'>
        用户标识，由开发者定义规则，需保证用户标识在应用内唯一。
      </Property>
    </Properties>
  </Col>
</Row>

---

<Heading
  url='/sessions'
  method='GET'
  title='获取会话列表'
  name='#sessions'
/>
<Row>
  <Col>
    获取当前用户的会话列表，默认返回最近的 20 条。

    ### Query

    <Properties>
      <Property name='last_id' type='string' key='last_id'>
        当前页最后面一条记录的 ID，默认 none
      </Property>
      <Property name='limit' type='int' key='limit'>
        一次请求返回多少条记录
      </Property>
      <Property name='user' type='string' key='user'>
        用户标识，由开发者定义规则，需保证用户标识在应用内唯一。
      </Property>
    </Properties>
  </Col>
</Row>

---

<Heading
  url='/sessions/{converation_id}/name'
  method='POST'
  title='会话重命名'
  name='#rename'
/>
<Row>
  <Col>
    对会话进行重命名，会话名称用于显示在支持多会话的客户端上。

    ### Request Body

    <Properties>
      <Property name='name' type='string' key='name'>
        新的名称
      </Property>
      <Property name='user' type='string' key='user'>
        用户标识，由开发者定义规则，需保证用户标识在应用内唯一。
      </Property>
    </Properties>
  </Col>
</Row>


---

<Heading
  url='/config'
  method='GET'
  title='获取应用配置信息'
  name='#rename'
/>
<Row>
  <Col>
    获取已配置的 Input 参数，包括变量名、字段名称、类型与默认值。通常用于客户端加载后显示这些字段的表单或填入默认值。

    ### Query

    <Properties>
      <Property name='user' type='string' key='user'>
        用户标识，由开发者定义规则，需保证用户标识在应用内唯一。
      </Property>
    </Properties>
  </Col>
</Row>
